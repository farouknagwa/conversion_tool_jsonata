(
  /* Extract AI template ID */
  $aiTemplateId := $string(part.ai.ai_template_id);
  
  /* Handle answer as array */
  $acceptableAnswers := $type(part.answer) = "array" ? part.answer : [part.answer];
  
  /* Return the complete part structure */
  {
    "n": part.n,
    "type": "frq",
    "stem": part.stem,
    "ai_template_id": $aiTemplateId,
    "acceptable_answers": $acceptableAnswers,
    "explanation": explanation
  }
)

